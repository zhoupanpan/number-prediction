var p=(o,e,l)=>new Promise((a,r)=>{var i=n=>{try{d(l.next(n))}catch(R){r(R)}},s=n=>{try{d(l.throw(n))}catch(R){r(R)}},d=n=>n.done?a(n.value):Promise.resolve(n.value).then(i,s);d((l=l.apply(o,e)).next())});import{_ as T,c,d as t,t as u,w as b,v as y,e as m,F as k,r as f,k as v,l as C,o as h,n as w,i as I,p as D}from"./index-CupCqOdc.js";const g=C.createInstance({name:"number-prediction-db",storeName:"kill-two-code-maintenance"}),x={name:"KillTwoCodeMaintenance",data(){return{records:[],batchRows:[],batchInputText:"",batchFormData:{period:""},editingId:null,searchTerm:"",selectedRecords:[],selectAll:!1,currentPage:1,pageSize:10,hasTestData:!1}},computed:{filteredRecords(){let o=this.records;if(this.searchTerm){const l=this.searchTerm.toLowerCase();o=o.filter(a=>a.period.toLowerCase().includes(l)||a.killTwoCode.toLowerCase().includes(l))}const e=(this.currentPage-1)*this.pageSize;return o.slice(e,e+this.pageSize)},totalPages(){return Math.ceil(this.records.length/this.pageSize)},canSaveBatch(){return this.batchRows.length>0&&this.batchFormData.period&&this.batchRows.every(o=>!o.isError&&o.killTwoCode&&o.priority)}},mounted(){return p(this,null,function*(){yield this.loadAllRecords(),this.checkTestData(),yield this.loadMaxPeriod()})},methods:{loadAllRecords(){return p(this,null,function*(){try{this.records=[];const e=(yield g.keys()).map(l=>p(this,null,function*(){const a=yield g.getItem(l);a&&this.records.push(a)}));yield Promise.all(e),this.records.sort((l,a)=>l.period!==a.period?a.period.localeCompare(l.period):l.priority-a.priority)}catch(o){console.error("加载记录失败:",o),alert("加载记录失败，请重试")}})},validateKillTwoCode(o){if(o.killTwoCode=o.killTwoCode.replace(/[^0-9]/g,""),o.killTwoCode.length!==2){o.isError=!0,o.errorMessage="杀二码组合必须是2位数字";return}const e=this.normalizeKillTwoCode(o.killTwoCode);if(this.batchRows.some((a,r)=>r!==this.batchRows.indexOf(o)&&this.normalizeKillTwoCode(a.killTwoCode)===e)){o.isError=!0,o.errorMessage="杀二码组合不能重复";return}o.isError=!1,o.errorMessage=""},normalizeKillTwoCode(o){return o.split("").sort().join("")},processBatchInput(){if(!this.batchInputText.trim())return;const o=this.batchInputText.split(/[,，]/).map(l=>l.replace(/\s/g,"").trim()).filter(l=>l);let e=0;o.forEach(l=>{l.length===2&&/^\d{2}$/.test(l)?(this.addBatchRowWithData(l),e++):console.log("无效的杀二码组合:",l)}),e>0?alert(`成功导入 ${e} 组杀二码组合`):alert("未找到有效的杀二码组合数据（必须为2位数字）"),this.batchInputText=""},addBatchRow(){this.batchRows.push({id:Date.now()+Math.random(),killTwoCode:"",priority:2,isError:!1,errorMessage:""})},addBatchRowWithData(o){this.batchRows.push({id:Date.now()+Math.random(),killTwoCode:o,priority:2,isError:!1,errorMessage:""})},removeBatchRow(o){this.batchRows.splice(o,1)},clearBatchRows(){this.batchRows=[]},saveBatchRecords(){return p(this,null,function*(){try{const e=this.batchRows.map(l=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),period:this.batchFormData.period,killTwoCode:l.killTwoCode,priority:parseInt(l.priority),createdAt:Date.now()})).map(l=>g.setItem(l.id,l));yield Promise.all(e),alert("批量保存成功！"),this.batchRows=[],this.batchFormData.period="",yield this.loadAllRecords()}catch(o){console.error("批量保存失败:",o),alert("批量保存失败，请重试")}})},cancelEdit(){this.editingId=null,this.batchRows=[],this.batchFormData.period=""},editRecord(o){this.editingId=o.id,this.batchFormData.period=o.period,this.batchRows=[{id:o.id,killTwoCode:o.killTwoCode,priority:o.priority,isError:!1,errorMessage:""}]},deleteRecord(o){return p(this,null,function*(){if(confirm("确定要删除这条记录吗？"))try{yield g.removeItem(o),alert("记录删除成功"),yield this.loadAllRecords()}catch(e){console.error("删除记录失败:",e),alert("删除记录失败，请重试")}})},deleteSelectedRecords(){return p(this,null,function*(){if(this.selectedRecords.length!==0&&confirm(`确定要删除选中的 ${this.selectedRecords.length} 条记录吗？`))try{const o=this.selectedRecords.map(e=>g.removeItem(e));yield Promise.all(o),alert("批量删除成功"),this.selectedRecords=[],this.selectAll=!1,yield this.loadAllRecords()}catch(o){console.error("批量删除失败:",o),alert("批量删除失败，请重试")}})},toggleSelectAll(){this.selectAll?this.selectedRecords=this.filteredRecords.map(o=>o.id):this.selectedRecords=[]},getPriorityText(o){return{1:"最高",2:"高",3:"中",4:"低",5:"最低"}[o]||"未知"},formatDate(o){return new Date(o).toLocaleString("zh-CN")},checkTestData(){this.hasTestData=this.records.some(o=>o.period.includes("test")||o.period.includes("测试"))},loadMaxPeriod(){return p(this,null,function*(){try{const o=C.createInstance({name:"number-prediction-db",storeName:"period-management"}),e=yield o.keys(),l=[];for(const a of e){const r=yield o.getItem(a);r&&r.periodNumber&&l.push(r.periodNumber)}if(l.length>0){l.sort((r,i)=>i.localeCompare(r));const a=l[0];this.batchFormData.period=a,console.log("自动加载最大期号:",a)}else console.log("期号管理列表为空，无法加载最大期号")}catch(o){console.error("加载最大期号失败:",o)}})}}},B={class:"kill-two-code-maintenance"},M={class:"panel"},P={class:"batch-form-section"},S={class:"batch-controls"},_={class:"form-group"},A=["disabled"],E={class:"form-group"},V={class:"batch-table-container"},F={class:"batch-table"},z=["onUpdate:modelValue","onInput"],U={key:0,class:"error-message"},N=["onUpdate:modelValue"],K=["onClick"],L={key:0},q={class:"batch-actions"},W=["disabled"],j={class:"table-section"},O={class:"search-group"},G=["disabled"],H={class:"data-table"},J={class:"checkbox-col"},Q={class:"checkbox-col"},X=["value"],Y={class:"action-buttons"},Z=["onClick"],$=["onClick"],ee={key:0},te={key:0,class:"pagination"},oe=["disabled"],se={class:"page-info"},le=["disabled"];function re(o,e,l,a,r,i){return h(),c("div",B,[t("div",M,[e[26]||(e[26]=t("h2",null,"杀二码组合维护",-1)),e[27]||(e[27]=t("p",null,"管理不同期号的杀二码组合，设置优先级，用于数字预测",-1)),t("div",P,[t("h3",null,u(r.editingId?"编辑杀二码组合":"批量添加杀二码组合"),1),t("div",S,[t("div",_,[e[14]||(e[14]=t("label",{for:"period"},"期号 *",-1)),b(t("input",{id:"period","onUpdate:modelValue":e[0]||(e[0]=s=>r.batchFormData.period=s),type:"text",placeholder:"请输入期号，如：2024001",disabled:r.editingId,required:""},null,8,A),[[y,r.batchFormData.period]])]),t("div",E,[e[15]||(e[15]=t("label",{for:"batchInput"},"批量输入杀二码组合",-1)),b(t("input",{id:"batchInput","onUpdate:modelValue":e[1]||(e[1]=s=>r.batchInputText=s),type:"text",placeholder:"请输入多组杀二码组合，用逗号分隔（支持中英文逗号，如：12,34,56）",onBlur:e[2]||(e[2]=(...s)=>i.processBatchInput&&i.processBatchInput(...s))},null,544),[[y,r.batchInputText]])]),t("button",{type:"button",class:"btn-primary",onClick:e[3]||(e[3]=(...s)=>i.addBatchRow&&i.addBatchRow(...s))},"添加行"),t("button",{type:"button",class:"btn-secondary",onClick:e[4]||(e[4]=(...s)=>i.clearBatchRows&&i.clearBatchRows(...s))},"清空")]),t("div",V,[t("table",F,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",null,"序号"),t("th",null,"杀二码组合 *"),t("th",null,"优先级 *"),t("th",null,"操作")])],-1)),t("tbody",null,[(h(!0),c(k,null,f(r.batchRows,(s,d)=>(h(),c("tr",{key:s.id,class:w({"error-row":s.isError})},[t("td",null,u(d+1),1),t("td",null,[b(t("input",{"onUpdate:modelValue":n=>s.killTwoCode=n,type:"text",placeholder:"请输入2位数字，如：12",onInput:n=>i.validateKillTwoCode(s),class:w({"error-input":s.isError}),required:""},null,42,z),[[y,s.killTwoCode]]),s.isError?(h(),c("div",U,u(s.errorMessage),1)):m("",!0)]),t("td",null,[b(t("select",{"onUpdate:modelValue":n=>s.priority=n,required:""},[...e[16]||(e[16]=[D('<option value="1" data-v-b225bd0b>1 - 最高</option><option value="2" data-v-b225bd0b>2 - 高</option><option value="3" data-v-b225bd0b>3 - 中</option><option value="4" data-v-b225bd0b>4 - 低</option><option value="5" data-v-b225bd0b>5 - 最低</option>',5)])],8,N),[[I,s.priority]])]),t("td",null,[r.batchRows.length>1?(h(),c("button",{key:0,type:"button",class:"btn-delete",onClick:n=>i.removeBatchRow(d)},"删除",8,K)):m("",!0)])],2))),128))]),r.batchRows.length===0?(h(),c("tfoot",L,[...e[17]||(e[17]=[t("tr",null,[t("td",{colspan:"4",class:"no-data"},'请点击"添加行"开始录入杀二码组合数据')],-1)])])):m("",!0)])]),t("div",q,[t("button",{type:"button",class:"btn-primary",onClick:e[5]||(e[5]=(...s)=>i.saveBatchRecords&&i.saveBatchRecords(...s)),disabled:!i.canSaveBatch},"批量保存",8,W),t("button",{type:"button",class:"btn-secondary",onClick:e[6]||(e[6]=(...s)=>i.cancelEdit&&i.cancelEdit(...s))},"取消")])]),t("div",j,[e[25]||(e[25]=t("h3",null,"杀二码组合列表",-1)),t("div",O,[b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>r.searchTerm=s),type:"text",placeholder:"搜索期号或杀二码组合...",class:"search-input"},null,512),[[y,r.searchTerm]]),t("button",{onClick:e[8]||(e[8]=(...s)=>i.deleteSelectedRecords&&i.deleteSelectedRecords(...s)),class:"btn-delete-batch",disabled:r.selectedRecords.length===0}," 批量删除 ",8,G)]),t("table",H,[t("thead",null,[t("tr",null,[t("th",J,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>r.selectAll=s),onChange:e[10]||(e[10]=(...s)=>i.toggleSelectAll&&i.toggleSelectAll(...s))},null,544),[[v,r.selectAll]])]),e[19]||(e[19]=t("th",null,"期号",-1)),e[20]||(e[20]=t("th",null,"杀二码组合",-1)),e[21]||(e[21]=t("th",null,"优先级",-1)),e[22]||(e[22]=t("th",null,"创建时间",-1)),e[23]||(e[23]=t("th",null,"操作",-1))])]),t("tbody",null,[(h(!0),c(k,null,f(i.filteredRecords,s=>(h(),c("tr",{key:s.id},[t("td",Q,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=d=>r.selectedRecords=d),value:s.id},null,8,X),[[v,r.selectedRecords]])]),t("td",null,u(s.period),1),t("td",null,u(s.killTwoCode),1),t("td",null,[t("span",{class:w(["priority-badge",`priority-${s.priority}`])},u(i.getPriorityText(s.priority)),3)]),t("td",null,u(i.formatDate(s.createdAt)),1),t("td",Y,[t("button",{class:"btn-edit",onClick:d=>i.editRecord(s)},"编辑",8,Z),t("button",{class:"btn-delete",onClick:d=>i.deleteRecord(s.id)},"删除",8,$)])]))),128))]),i.filteredRecords.length===0?(h(),c("tfoot",ee,[...e[24]||(e[24]=[t("tr",null,[t("td",{colspan:"6",class:"no-data"},"暂无数据")],-1)])])):m("",!0)]),i.totalPages>1?(h(),c("div",te,[t("button",{onClick:e[12]||(e[12]=s=>r.currentPage--),disabled:r.currentPage===1,class:"btn-pagination"}," 上一页 ",8,oe),t("span",se," 第 "+u(r.currentPage)+" / "+u(i.totalPages)+" 页 ",1),t("button",{onClick:e[13]||(e[13]=s=>r.currentPage++),disabled:r.currentPage===i.totalPages,class:"btn-pagination"}," 下一页 ",8,le)])):m("",!0)])])])}const ne=T(x,[["render",re],["__scopeId","data-v-b225bd0b"]]);export{ne as default};
