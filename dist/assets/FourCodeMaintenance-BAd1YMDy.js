var k=Object.defineProperty,F=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var R=(o,t,a)=>t in o?k(o,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[t]=a,v=(o,t)=>{for(var a in t||(t={}))x.call(t,a)&&R(o,a,t[a]);if(C)for(var a of C(t))S.call(t,a)&&R(o,a,t[a]);return o},D=(o,t)=>F(o,P(t));var h=(o,t,a)=>new Promise((l,i)=>{var s=n=>{try{m(a.next(n))}catch(g){i(g)}},r=n=>{try{m(a.throw(n))}catch(g){i(g)}},m=n=>n.done?l(n.value):Promise.resolve(n.value).then(s,r);m((a=a.apply(o,t)).next())});import{_ as V,c as d,d as e,t as p,w as u,v as f,i as w,e as b,F as I,r as B,l as T,o as c}from"./index-hVynY49a.js";const y=T.createInstance({name:"number-prediction-db",storeName:"four-code-maintenance"}),E={name:"FourCodeMaintenance",data(){return{records:[],searchPeriod:"",editingRecord:null,formData:{period:"",fourCode:"",codeType:"三四三断组",priority:1},batchFormData:{period:""},batchRows:[],batchInput:"",batchInputError:""}},computed:{filteredRecords(){return this.searchPeriod?this.records.filter(o=>o.period.includes(this.searchPeriod)):this.records},isFormValid(){const o=this.formData.codeType==="三四三断组"?this.formData.fourCode.length===3||this.formData.fourCode.length===4:this.formData.fourCode.length===4;return this.formData.period&&o&&this.formData.priority>=1&&this.formData.priority<=100},canSaveBatch(){return this.batchFormData.period&&this.batchRows.length>0&&this.batchRows.every(o=>o.fourCode&&(o.codeType==="三四三断组"&&o.fourCode.length===3||o.fourCode.length===4)&&o.priority>=1&&o.priority<=100&&this.validateBatchFourCode(o))}},mounted(){return h(this,null,function*(){yield this.loadAllRecords();for(let o=0;o<3;o++)this.addBatchRow();yield this.loadMaxPeriod()})},methods:{loadMaxPeriod(){return h(this,null,function*(){try{const o=T.createInstance({name:"number-prediction-db",storeName:"period-management"}),t=yield o.keys(),a=[],l=t.map(i=>h(this,null,function*(){const s=yield o.getItem(i);s&&s.periodNumber&&a.push(s)}));if(yield Promise.all(l),a.length>0){a.sort((s,r)=>r.periodNumber.localeCompare(s.periodNumber));const i=a[0].periodNumber;this.batchFormData.period=i,console.log(`已自动加载最大期号: ${i}`)}else console.log("期号管理列表中暂无期号记录")}catch(o){console.error("加载最大期号失败:",o)}})},loadAllRecords(){return h(this,null,function*(){try{this.records=[];const t=(yield y.keys()).map(a=>h(this,null,function*(){const l=yield y.getItem(a);l&&this.records.push(l)}));yield Promise.all(t),this.records.sort((a,l)=>a.period!==l.period?l.period.localeCompare(a.period):a.priority-l.priority)}catch(o){console.error("加载记录失败:",o),alert("加载记录失败，请重试")}})},validateFourCodeInput(){this.formData.fourCode=this.formData.fourCode.replace(/[^0-9]/g,"").slice(0,4)},saveRecord(){return h(this,null,function*(){try{if(this.editingRecord){const o=D(v({},this.editingRecord),{fourCode:this.formData.fourCode,codeType:this.formData.codeType,priority:this.formData.priority});yield y.setItem(o.id,o),alert("记录更新成功")}else{const o={id:Date.now().toString(),period:this.formData.period,fourCode:this.formData.fourCode,codeType:this.formData.codeType,priority:this.formData.priority,timestamp:Date.now()};yield y.setItem(o.id,o),alert("记录保存成功")}this.resetForm(),yield this.loadAllRecords()}catch(o){console.error("保存记录失败:",o),alert("保存记录失败，请重试")}})},editRecord(o){this.editingRecord=o,this.formData={period:o.period,fourCode:o.fourCode,codeType:o.codeType||"四断组",priority:o.priority},window.scrollTo({top:0,behavior:"smooth"})},deleteRecord(o){return h(this,null,function*(){if(confirm("确定要删除这条记录吗？"))try{yield y.removeItem(o),alert("记录删除成功"),yield this.loadAllRecords()}catch(t){console.error("删除记录失败:",t),alert("删除记录失败，请重试")}})},cancelEdit(){this.resetForm()},resetForm(){this.editingRecord=null,this.formData={period:"",fourCode:"",codeType:"三四三断组",priority:1}},searchRecords(){},resetSearch(){this.searchPeriod=""},validateBatchInput(){const o=this.batchInput.trim();if(!o){this.batchInputError="";return}if(!/^[0-9,，\s]*$/.test(o)){this.batchInputError="输入只能包含数字、逗号和空格（支持中英文逗号，空格将被自动过滤）";return}this.batchInputError=""},importBatchData(){if(!this.batchInput.trim()){alert("请输入要导入的四码组合数据");return}if(this.batchInputError){alert("输入格式有误，请检查后重试");return}try{const o=this.batchInput.split(/[,，]/).map(t=>t.replace(/\s/g,"").trim()).filter(t=>t);if(o.length===0){alert("未找到有效的四码组合数据");return}this.clearBatchRows(),o.forEach((t,a)=>{const l=t.length;(l===3||l===4)&&/^\d+$/.test(t)?this.batchRows.push({id:Date.now()+Math.random()+a,fourCode:t,codeType:"三四三断组",priority:1}):console.log("无效的数字组合:",t,"长度:",t.length)}),this.batchRows.length>0?(alert(`成功导入 ${this.batchRows.length} 组数字组合`),this.batchInput=""):alert(`未找到有效的数字组合数据（必须为3位或4位数字），解析结果：${JSON.stringify(o)}`)}catch(o){console.error("导入批量数据失败:",o),alert("导入失败，请重试")}},addBatchRow(){this.batchRows.push({id:Date.now()+Math.random(),fourCode:"",codeType:"三四三断组",priority:1})},removeBatchRow(o){this.batchRows.splice(o,1)},clearBatchRows(){this.batchRows=[]},saveBatchRecords(){return h(this,null,function*(){if(!this.canSaveBatch){alert("请填写完整的期号和所有四码组合数据");return}try{const o=this.records.filter(i=>i.period===this.batchFormData.period).map(i=>i.fourCode.split("").sort().join("")),t=this.batchRows.map(i=>{const s=i.fourCode.split("").sort().join("");return{id:Date.now().toString()+Math.random().toString(36).substr(2,9),period:this.batchFormData.period,fourCode:i.fourCode,codeType:i.codeType||"3",priority:i.priority,timestamp:Date.now()}}),a=[];if(t.forEach(i=>{const s=i.fourCode.split("").sort().join("");o.includes(s)&&a.push(i.fourCode)}),a.length>0){alert(`以下四码组合已存在，请勿重复添加：${a.join(", ")}`);return}const l=t.map(i=>y.setItem(i.id,i));yield Promise.all(l),this.clearBatchRows(),this.batchFormData.period="",yield this.loadAllRecords(),alert(`成功添加 ${t.length} 条四码组合记录`)}catch(o){console.error("批量保存记录失败:",o),alert("批量保存失败，请重试")}})},validateBatchFourCode(o){const{fourCode:t,codeType:a}=o;for(const l of t)if(!/^[0-9]$/.test(l))return!1;if(a==="四断组"){if(t.length!==4||[...new Set(t)].length!==4)return!1}else if(a==="三四三断组"&&(t.length!==3&&t.length!==4||t.length===4&&[...new Set(t)].length!==4))return!1;return!0},validateBatchFourCodeInput(o){o.fourCode=o.fourCode.replace(/[^0-9]/g,"").slice(0,4)},handleBatchInputBlur(){if(this.batchInput.trim()){const o=this.batchInput.split(/[\n,，]/).filter(t=>t.trim());this.batchRows=[],o.forEach((t,a)=>{const l=t.replace(/[^0-9]/g,""),i=l.length;(i===3||i===4)&&l&&this.batchRows.push({id:Date.now()+Math.random()+a,fourCode:l,codeType:"三四三断组",priority:1})}),this.batchRows.length>0&&console.log(`成功提取 ${this.batchRows.length} 组数字组合到批量列表`)}}}},U={class:"four-code-maintenance"},M={class:"panel"},_={class:"batch-form-section"},N={key:0,class:"edit-form"},q={class:"form-group"},A={class:"form-group"},L={class:"form-group"},j=["placeholder"],J={class:"form-group"},O={class:"form-actions"},z=["disabled"],G={key:1,class:"batch-controls"},H={class:"form-group"},K={class:"form-group"},Q={key:0,class:"error-message"},W={class:"batch-table-container"},X={class:"batch-table"},Y=["onUpdate:modelValue"],Z=["onUpdate:modelValue","placeholder","onInput"],$=["onUpdate:modelValue"],tt=["onClick"],et={key:0},ot={class:"batch-actions"},rt=["disabled"],it={class:"records-section"},st={class:"search-group"},at={class:"records-table-container"},lt={class:"records-table"},nt=["onClick"],dt=["onClick"],ct={key:0,class:"no-records"};function ut(o,t,a,l,i,s){return c(),d("div",U,[e("div",M,[t[30]||(t[30]=e("h2",null,"四码组合维护",-1)),e("div",_,[e("h3",null,p(i.editingRecord?"编辑四码组合":"批量添加四码组合"),1),i.editingRecord?(c(),d("div",N,[e("div",q,[t[18]||(t[18]=e("label",{for:"editPeriod"},"期号",-1)),u(e("input",{id:"editPeriod","onUpdate:modelValue":t[0]||(t[0]=r=>i.formData.period=r),type:"text",placeholder:"请输入期号",class:"input-field"},null,512),[[f,i.formData.period]])]),e("div",A,[t[20]||(t[20]=e("label",{for:"editCodeType"},"组合类型",-1)),u(e("select",{id:"editCodeType","onUpdate:modelValue":t[1]||(t[1]=r=>i.formData.codeType=r),class:"input-field"},[...t[19]||(t[19]=[e("option",{value:"三四三断组"},"三四三断组",-1),e("option",{value:"四断组"},"四断组",-1)])],512),[[w,i.formData.codeType]])]),e("div",L,[t[21]||(t[21]=e("label",{for:"editFourCode"},"数字组合",-1)),u(e("input",{id:"editFourCode","onUpdate:modelValue":t[2]||(t[2]=r=>i.formData.fourCode=r),type:"text",placeholder:i.formData.codeType==="三四三断组"?"请输入3位或4位数字":"请输入4位数字",maxlength:4,class:"input-field"},null,8,j),[[f,i.formData.fourCode]])]),e("div",J,[t[22]||(t[22]=e("label",{for:"editPriority"},"优先级",-1)),u(e("input",{id:"editPriority","onUpdate:modelValue":t[3]||(t[3]=r=>i.formData.priority=r),type:"number",min:"1",max:"100",class:"input-field",placeholder:"1-100"},null,512),[[f,i.formData.priority,void 0,{number:!0}]])]),e("div",O,[e("button",{type:"button",class:"btn-primary",onClick:t[4]||(t[4]=(...r)=>s.saveRecord&&s.saveRecord(...r)),disabled:!s.isFormValid},"保存",8,z),e("button",{type:"button",class:"btn-secondary",onClick:t[5]||(t[5]=(...r)=>s.cancelEdit&&s.cancelEdit(...r))},"取消")])])):(c(),d("div",G,[e("div",H,[t[23]||(t[23]=e("label",{for:"period"},"期号",-1)),u(e("input",{id:"period","onUpdate:modelValue":t[6]||(t[6]=r=>i.batchFormData.period=r),type:"text",placeholder:"请输入期号",class:"input-field"},null,512),[[f,i.batchFormData.period]])]),e("div",K,[t[24]||(t[24]=e("label",{for:"batchInput"},"批量输入四码组合",-1)),u(e("textarea",{id:"batchInput","onUpdate:modelValue":t[7]||(t[7]=r=>i.batchInput=r),placeholder:"请输入数字组合，每行一个，支持3位或4位数字",rows:"1",class:"input-field",onInput:t[8]||(t[8]=(...r)=>s.validateBatchInput&&s.validateBatchInput(...r)),onBlur:t[9]||(t[9]=(...r)=>s.handleBatchInputBlur&&s.handleBatchInputBlur(...r))},null,544),[[f,i.batchInput]]),i.batchInputError?(c(),d("span",Q,p(i.batchInputError),1)):b("",!0)]),e("button",{type:"button",class:"btn-primary",onClick:t[10]||(t[10]=(...r)=>s.addBatchRow&&s.addBatchRow(...r))},"添加行"),e("button",{type:"button",class:"btn-secondary",onClick:t[11]||(t[11]=(...r)=>s.importBatchData&&s.importBatchData(...r))},"导入"),e("button",{type:"button",class:"btn-secondary",onClick:t[12]||(t[12]=(...r)=>s.clearBatchRows&&s.clearBatchRows(...r))},"清空")])),e("div",W,[e("table",X,[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",null,"序号"),e("th",null,"组合类型 *"),e("th",null,"数字组合 *"),e("th",null,"优先级 *"),e("th",null,"操作")])],-1)),e("tbody",null,[(c(!0),d(I,null,B(i.batchRows,(r,m)=>(c(),d("tr",{key:r.id},[e("td",null,p(m+1),1),e("td",null,[u(e("select",{"onUpdate:modelValue":n=>r.codeType=n,class:"input-field",required:""},[...t[25]||(t[25]=[e("option",{value:"三四三断组"},"三四三断组",-1),e("option",{value:"四断组"},"四断组",-1)])],8,Y),[[w,r.codeType]])]),e("td",null,[u(e("input",{"onUpdate:modelValue":n=>r.fourCode=n,type:"text",placeholder:r.codeType==="三四三断组"?"请输入3位或4位数字":"请输入4位数字",maxlength:4,onInput:n=>s.validateBatchFourCodeInput(r),class:"input-field",required:""},null,40,Z),[[f,r.fourCode]])]),e("td",null,[u(e("input",{"onUpdate:modelValue":n=>r.priority=n,type:"number",min:"1",max:"100",class:"input-field",placeholder:"1-100",required:""},null,8,$),[[f,r.priority,void 0,{number:!0}]])]),e("td",null,[i.batchRows.length>1?(c(),d("button",{key:0,type:"button",class:"btn-delete",onClick:n=>s.removeBatchRow(m)},"删除",8,tt)):b("",!0)])]))),128))]),i.batchRows.length===0?(c(),d("tfoot",et,[...t[26]||(t[26]=[e("tr",null,[e("td",{colspan:"4",class:"no-data"},'请点击"添加行"开始录入四码组合数据')],-1)])])):b("",!0)])]),e("div",ot,[e("button",{type:"button",class:"btn-primary",onClick:t[13]||(t[13]=(...r)=>s.saveBatchRecords&&s.saveBatchRecords(...r)),disabled:!s.canSaveBatch},"批量保存",8,rt),e("button",{type:"button",class:"btn-secondary",onClick:t[14]||(t[14]=(...r)=>s.cancelEdit&&s.cancelEdit(...r))},"取消")])]),e("div",it,[t[29]||(t[29]=e("h3",null,"四码组合列表",-1)),e("div",st,[u(e("input",{"onUpdate:modelValue":t[15]||(t[15]=r=>i.searchPeriod=r),type:"text",placeholder:"搜索期号...",class:"input-field search-input"},null,512),[[f,i.searchPeriod]]),e("button",{onClick:t[16]||(t[16]=(...r)=>s.searchRecords&&s.searchRecords(...r)),class:"btn-secondary"},"搜索"),e("button",{onClick:t[17]||(t[17]=(...r)=>s.resetSearch&&s.resetSearch(...r)),class:"btn-secondary"},"重置")]),e("div",at,[e("table",lt,[t[28]||(t[28]=e("thead",null,[e("tr",null,[e("th",null,"期号"),e("th",null,"组合类型"),e("th",null,"数字组合"),e("th",null,"优先级"),e("th",null,"创建时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(c(!0),d(I,null,B(s.filteredRecords,r=>(c(),d("tr",{key:r.id},[e("td",null,p(r.period),1),e("td",null,p(r.codeType||"四断组"),1),e("td",null,p(r.fourCode),1),e("td",null,p(r.priority),1),e("td",null,p(new Date(r.timestamp).toLocaleString()),1),e("td",null,[e("button",{onClick:m=>s.editRecord(r),class:"btn-edit"},"编辑",8,nt),e("button",{onClick:m=>s.deleteRecord(r.id),class:"btn-delete"},"删除",8,dt)])]))),128))])])]),s.filteredRecords.length===0?(c(),d("div",ct,p(i.searchPeriod?"未找到匹配的记录":"暂无记录"),1)):b("",!0)])])])}const mt=V(E,[["render",ut],["__scopeId","data-v-973aa220"]]);export{mt as default};
