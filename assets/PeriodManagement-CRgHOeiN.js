var S=Object.defineProperty,F=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var k=(t,e,o)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,w=(t,e)=>{for(var o in e||(e={}))_.call(e,o)&&k(t,o,e[o]);if(I)for(var o of I(e))E.call(e,o)&&k(t,o,e[o]);return t},M=(t,e)=>F(t,x(e));var u=(t,e,o)=>new Promise((a,l)=>{var i=c=>{try{n(o.next(c))}catch(d){l(d)}},r=c=>{try{n(o.throw(c))}catch(d){l(d)}},n=c=>c.done?a(c.value):Promise.resolve(c.value).then(i,r);n((o=o.apply(t,e)).next())});import{l as T}from"./utils-DS-Dv-fG.js";import{c as P,a as s,b as R,n as C,e as L,t as y,p as f,v,F as D,q as V,u as z,o as p}from"./vendor-DNlG_nFR.js";import{_ as j}from"./index-DdKafPJf.js";const g=T.createInstance({name:"number-prediction-db",storeName:"period-management"}),U={name:"PeriodManagement",data(){return{periods:[],searchPeriod:"",latestPeriodFromAPI:"",latestLotteryResult:"",currentPeriod:"",editingPeriod:null,editForm:{periodNumber:"",status:"active"},message:"",messageType:"info"}},computed:{filteredPeriods(){return this.searchPeriod?this.periods.filter(t=>t.periodNumber.includes(this.searchPeriod)):this.periods}},mounted(){return u(this,null,function*(){yield this.loadAllPeriods()})},methods:{loadAllPeriods(){return u(this,null,function*(){try{this.periods=[];const e=(yield g.keys()).map(o=>u(this,null,function*(){const a=yield g.getItem(o);a&&this.periods.push(a)}));yield Promise.all(e),this.periods.sort((o,a)=>a.periodNumber.localeCompare(o.periodNumber))}catch(t){console.error("加载期号记录失败:",t),this.showMessage("加载期号记录失败，请重试","error")}})},fetchLatestPeriodInternal(){return u(this,null,function*(){try{const t=new Date,e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),c=yield fetch("https://www.mxnzp.com/api/lottery/common/history?code=fc3d&size=1&app_id=zsm9fvjchgeegusq&app_secret=GDfu7jmtIM8kyZpisLe0uGsf7gEPVo5S");if(!c.ok)throw new Error("网络请求失败");const d=yield c.json();if(console.log("API响应数据:",d),d&&d.code===1&&d.data){const m=Array.isArray(d.data)?d.data[0]:d.data,h=m.expect,b=m.openCode,N=this.periods.find(A=>A.periodNumber===h);if(N){const A=M(w({},N),{lotteryResult:b});yield g.setItem(N.id,A),this.latestPeriodFromAPI=h,yield this.loadAllPeriods(),console.log(`期号 ${h} 已存在，已更新开奖结果: ${b}`)}else this.latestPeriodFromAPI=h,this.latestLotteryResult=b,console.log(`成功获取最新期号: ${h}，开奖结果: ${b}`);return{latestPeriod:h,lotteryResult:b}}else return this.latestPeriodFromAPI="2024001",this.latestLotteryResult="123",console.log("API调用失败，使用模拟数据"),{latestPeriod:"2024001",lotteryResult:"123"}}catch(t){return console.error("获取最新期号失败:",t),this.latestPeriodFromAPI="2024001",this.latestLotteryResult="123",console.log("获取最新期号失败，使用模拟数据"),{latestPeriod:"2024001",lotteryResult:"123"}}})},generateCurrentPeriod(){return u(this,null,function*(){try{console.log("正在获取最新期号...");const{latestPeriod:t,lotteryResult:e}=yield this.fetchLatestPeriodInternal(),o=parseInt(t);if(isNaN(o))throw new Error("期号格式错误");this.currentPeriod=(o+1).toString().padStart(t.length,"0");let a=e;if(this.currentPeriod!==t&&(a="",console.log(`期号不一致：最新期号${t}，当前期号${this.currentPeriod}，开奖号置为空`)),this.periods.find(i=>i.periodNumber===this.currentPeriod)){this.showMessage(`期号 ${this.currentPeriod} 已存在，请勿重复添加`,"error");return}console.log("当期期号已生成: "+this.currentPeriod),this.showMessage(`最新期号获取成功: ${t}，当期期号已生成: ${this.currentPeriod}`,"success")}catch(t){console.error("生成当期期号失败:",t),this.showMessage("生成当期期号失败，请检查网络连接或期号格式","error")}})},saveCurrentPeriod(){return u(this,null,function*(){if(!this.currentPeriod){alert("请先生成当期期号");return}try{if(this.periods.find(a=>a.periodNumber===this.currentPeriod)){this.showMessage(`期号 ${this.currentPeriod} 已存在，请勿重复添加`,"error");return}let e=this.latestLotteryResult||"";this.latestPeriodFromAPI&&this.currentPeriod!==this.latestPeriodFromAPI&&(e="",console.log(`期号不一致：最新期号${this.latestPeriodFromAPI}，当前期号${this.currentPeriod}，开奖号置为空`));const o={id:Date.now().toString()+Math.random().toString(36).substr(2,9),periodNumber:this.currentPeriod,lotteryResult:e,status:"active",timestamp:Date.now()};yield g.setItem(o.id,o),yield this.loadAllPeriods(),console.log("期号保存成功: "+this.currentPeriod),this.showMessage(`期号 ${this.currentPeriod} 保存成功`,"success"),this.currentPeriod=""}catch(t){console.error("保存期号失败:",t),this.showMessage("保存期号失败，请重试","error")}})},editPeriod(t){this.editingPeriod=t,this.editForm={periodNumber:t.periodNumber,status:t.status,lotteryResult:t.lotteryResult||""}},saveEditedPeriod(){return u(this,null,function*(){if(!this.editForm.periodNumber){alert("请输入期号");return}try{if(this.periods.find(o=>o.periodNumber===this.editForm.periodNumber&&o.id!==this.editingPeriod.id)){alert("该期号已存在，请使用其他期号");return}const e=M(w({},this.editingPeriod),{periodNumber:this.editForm.periodNumber,status:this.editForm.status,lotteryResult:this.editForm.lotteryResult});yield g.setItem(e.id,e),yield this.loadAllPeriods(),this.cancelEdit(),console.log("期号编辑成功"),this.showMessage("期号编辑成功","success")}catch(t){console.error("编辑期号失败:",t),this.showMessage("编辑期号失败，请重试","error")}})},deletePeriod(t){return u(this,null,function*(){if(confirm("确定要删除这条期号记录吗？"))try{yield g.removeItem(t),console.log("期号删除成功"),this.showMessage("期号删除成功","success"),yield this.loadAllPeriods()}catch(e){console.error("删除期号失败:",e),this.showMessage("删除期号失败，请重试","error")}})},cancelEdit(){this.editingPeriod=null,this.editForm={periodNumber:"",status:"active",lotteryResult:""}},syncLotteryResult(t){return u(this,null,function*(){try{this.showMessage(`正在同步期号 ${t.periodNumber} 的开奖结果...`,"info");const e="zsm9fvjchgeegusq",o="GDfu7jmtIM8kyZpisLe0uGsf7gEPVo5S",a=1,l="fc3d",i=t.periodNumber,r=yield fetch(`https://www.mxnzp.com/api/lottery/common/history?code=${l}&size=${a}&expect=${i}&app_id=${e}&app_secret=${o}`);if(!r.ok)throw new Error("网络请求失败");const n=yield r.json();if(console.log("API响应数据:",n),n&&n.code===1&&n.data){const d=(Array.isArray(n.data)?n.data:[n.data]).find(m=>m.expect===t.periodNumber);if(d){const m=d.openCode,h=M(w({},t),{lotteryResult:m});yield g.setItem(t.id,h),yield this.loadAllPeriods(),this.showMessage(`期号 ${t.periodNumber} 开奖结果同步成功: ${m}`,"success"),console.log(`期号 ${t.periodNumber} 开奖结果同步成功: ${m}`)}else this.showMessage(`未找到期号 ${t.periodNumber} 的开奖记录，请确认期号是否正确或该期是否已开奖`,"error")}else{const c=n?`API返回错误: code=${n.code}, msg=${n.msg}`:"API返回数据为空";throw console.error("API返回数据格式错误详情:",n),new Error(c)}}catch(e){console.error("同步开奖号失败:",e),this.showMessage(`同步开奖号失败: ${e.message}`,"error")}})},showMessage(t,e="info"){this.message=t,this.messageType=e,setTimeout(()=>{this.clearMessage()},5e3)},clearMessage(){this.message="",this.messageType="info"},searchPeriods(){},resetSearch(){this.searchPeriod=""},getStatusText(t){return{active:"活跃",inactive:"非活跃",archived:"已归档"}[t]||"未知"},getStatusClass(t){return{active:"status-active",inactive:"status-inactive",archived:"status-archived"}[t]||"status-unknown"}}},G={class:"period-management"},q={class:"panel"},B={class:"generation-section"},Z={class:"generation-controls"},Y={class:"form-group"},H={class:"form-group"},J={class:"form-actions"},K={class:"management-section"},O={class:"search-group"},Q={class:"periods-table-container"},W={class:"periods-table"},X={key:0,class:"lottery-result"},$={key:1,class:"no-lottery"},ee={class:"action-buttons"},te=["onClick"],se=["onClick"],re=["onClick"],oe={key:0,class:"no-periods"},ie={key:1,class:"modal-overlay"},le={class:"modal-content"},ne={class:"modal-form"},ae={class:"form-group"},de={class:"form-group"},ce={class:"form-group"},ue={class:"modal-actions"};function me(t,e,o,a,l,i){return p(),P("div",G,[s("div",q,[e[23]||(e[23]=s("h2",null,"期号统一管理",-1)),l.message?(p(),P("div",{key:0,class:C(["message",l.messageType])},[L(y(l.message)+" ",1),s("button",{onClick:e[0]||(e[0]=(...r)=>i.clearMessage&&i.clearMessage(...r)),class:"message-close"},"×")],2)):R("",!0),s("div",B,[e[15]||(e[15]=s("h3",null,"期号生成",-1)),s("div",Z,[s("div",Y,[e[13]||(e[13]=s("label",{for:"latestPeriod"},"最新期号",-1)),f(s("input",{id:"latestPeriod","onUpdate:modelValue":e[1]||(e[1]=r=>l.latestPeriodFromAPI=r),type:"text",placeholder:"自动获取最新期号",class:"input-field",readonly:""},null,512),[[v,l.latestPeriodFromAPI]])]),s("div",H,[e[14]||(e[14]=s("label",{for:"currentPeriod"},"当期期号",-1)),f(s("input",{id:"currentPeriod","onUpdate:modelValue":e[2]||(e[2]=r=>l.currentPeriod=r),type:"text",placeholder:"当期期号（自动+1生成）",class:"input-field"},null,512),[[v,l.currentPeriod]])]),s("div",J,[s("button",{type:"button",class:"btn-primary",onClick:e[3]||(e[3]=(...r)=>i.generateCurrentPeriod&&i.generateCurrentPeriod(...r))},"生成当期期号"),s("button",{type:"button",class:"btn-secondary",onClick:e[4]||(e[4]=(...r)=>i.saveCurrentPeriod&&i.saveCurrentPeriod(...r))},"保存当期期号")])])]),s("div",K,[e[17]||(e[17]=s("h3",null,"期号管理",-1)),s("div",O,[f(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>l.searchPeriod=r),type:"text",placeholder:"搜索期号...",class:"input-field search-input"},null,512),[[v,l.searchPeriod]]),s("button",{onClick:e[6]||(e[6]=(...r)=>i.searchPeriods&&i.searchPeriods(...r)),class:"btn-secondary"},"搜索"),s("button",{onClick:e[7]||(e[7]=(...r)=>i.resetSearch&&i.resetSearch(...r)),class:"btn-secondary"},"重置")]),s("div",Q,[s("table",W,[e[16]||(e[16]=s("thead",null,[s("tr",null,[s("th",null,"期号"),s("th",null,"开奖号"),s("th",null,"创建时间"),s("th",null,"状态"),s("th",null,"操作")])],-1)),s("tbody",null,[(p(!0),P(D,null,V(i.filteredPeriods,r=>(p(),P("tr",{key:r.id},[s("td",null,y(r.periodNumber),1),s("td",null,[r.lotteryResult?(p(),P("span",X,y(r.lotteryResult),1)):(p(),P("span",$,"未开奖"))]),s("td",null,y(new Date(r.timestamp).toLocaleString()),1),s("td",null,[s("span",{class:C(i.getStatusClass(r.status))},y(i.getStatusText(r.status)),3)]),s("td",null,[s("div",ee,[s("button",{onClick:n=>i.syncLotteryResult(r),class:"btn-sync"},"同步",8,te),s("button",{onClick:n=>i.editPeriod(r),class:"btn-edit"},"编辑",8,se),s("button",{onClick:n=>i.deletePeriod(r.id),class:"btn-delete"},"删除",8,re)])])]))),128))])])]),i.filteredPeriods.length===0?(p(),P("div",oe,y(l.searchPeriod?"未找到匹配的期号":"暂无期号记录"),1)):R("",!0)]),l.editingPeriod?(p(),P("div",ie,[s("div",le,[e[22]||(e[22]=s("h3",null,"编辑期号",-1)),s("div",ne,[s("div",ae,[e[18]||(e[18]=s("label",{for:"editPeriodNumber"},"期号",-1)),f(s("input",{id:"editPeriodNumber","onUpdate:modelValue":e[8]||(e[8]=r=>l.editForm.periodNumber=r),type:"text",class:"input-field",placeholder:"请输入期号"},null,512),[[v,l.editForm.periodNumber]])]),s("div",de,[e[19]||(e[19]=s("label",null,"开奖号",-1)),f(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>l.editForm.lotteryResult=r),type:"text",class:"input-field",placeholder:"开奖号"},null,512),[[v,l.editForm.lotteryResult]])]),s("div",ce,[e[21]||(e[21]=s("label",{for:"editStatus"},"状态",-1)),f(s("select",{id:"editStatus","onUpdate:modelValue":e[10]||(e[10]=r=>l.editForm.status=r),class:"input-field"},[...e[20]||(e[20]=[s("option",{value:"active"},"活跃",-1),s("option",{value:"inactive"},"非活跃",-1),s("option",{value:"archived"},"已归档",-1)])],512),[[z,l.editForm.status]])]),s("div",ue,[s("button",{type:"button",class:"btn-primary",onClick:e[11]||(e[11]=(...r)=>i.saveEditedPeriod&&i.saveEditedPeriod(...r))},"保存"),s("button",{type:"button",class:"btn-secondary",onClick:e[12]||(e[12]=(...r)=>i.cancelEdit&&i.cancelEdit(...r))},"取消")])])])])):R("",!0)])])}const ye=j(U,[["render",me],["__scopeId","data-v-a0a5fa61"]]);export{ye as default};
