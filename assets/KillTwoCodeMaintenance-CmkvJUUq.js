var u=(o,t,l)=>new Promise((a,r)=>{var i=n=>{try{d(l.next(n))}catch(R){r(R)}},s=n=>{try{d(l.throw(n))}catch(R){r(R)}},d=n=>n.done?a(n.value):Promise.resolve(n.value).then(i,s);d((l=l.apply(o,t)).next())});import{l as C}from"./utils-DS-Dv-fG.js";import{c,a as e,p as b,v as y,b as m,F as k,q as f,x as v,t as p,o as h,n as w,u as T,y as D}from"./vendor-DNlG_nFR.js";import{_ as I}from"./index-DdKafPJf.js";const g=C.createInstance({name:"number-prediction-db",storeName:"kill-two-code-maintenance"}),x={name:"KillTwoCodeMaintenance",data(){return{records:[],batchRows:[],batchInputText:"",batchFormData:{period:""},editingId:null,searchTerm:"",selectedRecords:[],selectAll:!1,currentPage:1,pageSize:10,hasTestData:!1}},computed:{filteredRecords(){let o=this.records;if(this.searchTerm){const l=this.searchTerm.toLowerCase();o=o.filter(a=>a.period.toLowerCase().includes(l)||a.killTwoCode.toLowerCase().includes(l))}const t=(this.currentPage-1)*this.pageSize;return o.slice(t,t+this.pageSize)},totalPages(){return Math.ceil(this.records.length/this.pageSize)},canSaveBatch(){return this.batchRows.length>0&&this.batchFormData.period&&this.batchRows.every(o=>!o.isError&&o.killTwoCode&&o.priority)}},mounted(){return u(this,null,function*(){yield this.loadAllRecords(),this.checkTestData(),yield this.loadMaxPeriod()})},methods:{loadAllRecords(){return u(this,null,function*(){try{this.records=[];const t=(yield g.keys()).map(l=>u(this,null,function*(){const a=yield g.getItem(l);a&&this.records.push(a)}));yield Promise.all(t),this.records.sort((l,a)=>l.period!==a.period?a.period.localeCompare(l.period):l.priority-a.priority)}catch(o){console.error("加载记录失败:",o),alert("加载记录失败，请重试")}})},validateKillTwoCode(o){if(o.killTwoCode=o.killTwoCode.replace(/[^0-9]/g,""),o.killTwoCode.length!==2){o.isError=!0,o.errorMessage="杀二码组合必须是2位数字";return}const t=this.normalizeKillTwoCode(o.killTwoCode);if(this.batchRows.some((a,r)=>r!==this.batchRows.indexOf(o)&&this.normalizeKillTwoCode(a.killTwoCode)===t)){o.isError=!0,o.errorMessage="杀二码组合不能重复";return}o.isError=!1,o.errorMessage=""},normalizeKillTwoCode(o){return o.split("").sort().join("")},processBatchInput(){if(!this.batchInputText.trim())return;const o=this.batchInputText.split(/[,，]/).map(l=>l.replace(/\s/g,"").trim()).filter(l=>l);let t=0;o.forEach(l=>{l.length===2&&/^\d{2}$/.test(l)?(this.addBatchRowWithData(l),t++):console.log("无效的杀二码组合:",l)}),t>0?alert(`成功导入 ${t} 组杀二码组合`):alert("未找到有效的杀二码组合数据（必须为2位数字）"),this.batchInputText=""},addBatchRow(){this.batchRows.push({id:Date.now()+Math.random(),killTwoCode:"",priority:2,isError:!1,errorMessage:""})},addBatchRowWithData(o){this.batchRows.push({id:Date.now()+Math.random(),killTwoCode:o,priority:2,isError:!1,errorMessage:""})},removeBatchRow(o){this.batchRows.splice(o,1)},clearBatchRows(){this.batchRows=[]},saveBatchRecords(){return u(this,null,function*(){try{const t=this.batchRows.map(l=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),period:this.batchFormData.period,killTwoCode:l.killTwoCode,priority:parseInt(l.priority),createdAt:Date.now()})).map(l=>g.setItem(l.id,l));yield Promise.all(t),alert("批量保存成功！"),this.batchRows=[],this.batchFormData.period="",yield this.loadAllRecords()}catch(o){console.error("批量保存失败:",o),alert("批量保存失败，请重试")}})},cancelEdit(){this.editingId=null,this.batchRows=[],this.batchFormData.period=""},editRecord(o){this.editingId=o.id,this.batchFormData.period=o.period,this.batchRows=[{id:o.id,killTwoCode:o.killTwoCode,priority:o.priority,isError:!1,errorMessage:""}]},deleteRecord(o){return u(this,null,function*(){if(confirm("确定要删除这条记录吗？"))try{yield g.removeItem(o),alert("记录删除成功"),yield this.loadAllRecords()}catch(t){console.error("删除记录失败:",t),alert("删除记录失败，请重试")}})},deleteSelectedRecords(){return u(this,null,function*(){if(this.selectedRecords.length!==0&&confirm(`确定要删除选中的 ${this.selectedRecords.length} 条记录吗？`))try{const o=this.selectedRecords.map(t=>g.removeItem(t));yield Promise.all(o),alert("批量删除成功"),this.selectedRecords=[],this.selectAll=!1,yield this.loadAllRecords()}catch(o){console.error("批量删除失败:",o),alert("批量删除失败，请重试")}})},toggleSelectAll(){this.selectAll?this.selectedRecords=this.filteredRecords.map(o=>o.id):this.selectedRecords=[]},getPriorityText(o){return{1:"最高",2:"高",3:"中",4:"低",5:"最低"}[o]||"未知"},formatDate(o){return new Date(o).toLocaleString("zh-CN")},checkTestData(){this.hasTestData=this.records.some(o=>o.period.includes("test")||o.period.includes("测试"))},loadMaxPeriod(){return u(this,null,function*(){try{const o=C.createInstance({name:"number-prediction-db",storeName:"period-management"}),t=yield o.keys(),l=[];for(const a of t){const r=yield o.getItem(a);r&&r.periodNumber&&l.push(r.periodNumber)}if(l.length>0){l.sort((r,i)=>i.localeCompare(r));const a=l[0];this.batchFormData.period=a,console.log("自动加载最大期号:",a)}else console.log("期号管理列表为空，无法加载最大期号")}catch(o){console.error("加载最大期号失败:",o)}})}}},B={class:"kill-two-code-maintenance"},M={class:"panel"},P={class:"batch-form-section"},_={class:"batch-controls"},S={class:"form-group"},A=["disabled"],E={class:"form-group"},V={class:"batch-actions"},F={class:"batch-table-container"},z={class:"batch-table"},U=["onUpdate:modelValue","onInput"],N={key:0,class:"error-message"},K=["onUpdate:modelValue"],L=["onClick"],q={key:0},W={class:"batch-actions"},j=["disabled"],O={class:"table-section"},G={class:"search-group"},H=["disabled"],J={class:"records-table-container"},Q={class:"data-table"},X={class:"checkbox-col"},Y={class:"checkbox-col"},Z=["value"],$={class:"action-buttons"},tt=["onClick"],et=["onClick"],ot={key:0},st={key:0,class:"pagination"},lt=["disabled"],rt={class:"page-info"},it=["disabled"];function at(o,t,l,a,r,i){return h(),c("div",B,[e("div",M,[t[26]||(t[26]=e("h2",null,"杀二码组合维护",-1)),t[27]||(t[27]=e("p",null,"管理不同期号的杀二码组合，设置优先级，用于数字预测",-1)),e("div",P,[e("div",_,[e("div",S,[t[14]||(t[14]=e("label",{for:"period"},"期号 *",-1)),b(e("input",{id:"period","onUpdate:modelValue":t[0]||(t[0]=s=>r.batchFormData.period=s),type:"text",placeholder:"请输入期号，如：2024001",disabled:r.editingId,required:""},null,8,A),[[y,r.batchFormData.period]])]),e("div",E,[t[15]||(t[15]=e("label",{for:"batchInput"},"批量输入杀二码组合",-1)),b(e("input",{id:"batchInput","onUpdate:modelValue":t[1]||(t[1]=s=>r.batchInputText=s),type:"text",placeholder:"请输入多组杀二码组合，用逗号分隔（支持中英文逗号，如：12,34,56）",onBlur:t[2]||(t[2]=(...s)=>i.processBatchInput&&i.processBatchInput(...s))},null,544),[[y,r.batchInputText]])]),e("div",V,[e("button",{type:"button",class:"btn-primary",onClick:t[3]||(t[3]=(...s)=>i.addBatchRow&&i.addBatchRow(...s))},"添加行"),e("button",{type:"button",class:"btn-secondary",onClick:t[4]||(t[4]=(...s)=>i.clearBatchRows&&i.clearBatchRows(...s))},"清空")])]),e("div",F,[e("table",z,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",null,"序号"),e("th",null,"杀二码组合 *"),e("th",null,"优先级 *"),e("th",null,"操作")])],-1)),e("tbody",null,[(h(!0),c(k,null,f(r.batchRows,(s,d)=>(h(),c("tr",{key:s.id,class:w({"error-row":s.isError})},[e("td",null,p(d+1),1),e("td",null,[b(e("input",{"onUpdate:modelValue":n=>s.killTwoCode=n,type:"text",placeholder:"请输入2位数字，如：12",onInput:n=>i.validateKillTwoCode(s),class:w({"error-input":s.isError}),required:""},null,42,U),[[y,s.killTwoCode]]),s.isError?(h(),c("div",N,p(s.errorMessage),1)):m("",!0)]),e("td",null,[b(e("select",{"onUpdate:modelValue":n=>s.priority=n,required:""},[...t[16]||(t[16]=[D('<option value="1" data-v-17780ad1>1 - 最高</option><option value="2" data-v-17780ad1>2 - 高</option><option value="3" data-v-17780ad1>3 - 中</option><option value="4" data-v-17780ad1>4 - 低</option><option value="5" data-v-17780ad1>5 - 最低</option>',5)])],8,K),[[T,s.priority]])]),e("td",null,[r.batchRows.length>1?(h(),c("button",{key:0,type:"button",class:"btn-delete",onClick:n=>i.removeBatchRow(d)},"删除",8,L)):m("",!0)])],2))),128))]),r.batchRows.length===0?(h(),c("tfoot",q,[...t[17]||(t[17]=[e("tr",null,[e("td",{colspan:"4",class:"no-data"},'请点击"添加行"开始录入杀二码组合数据')],-1)])])):m("",!0)])]),e("div",W,[e("button",{type:"button",class:"btn-primary",onClick:t[5]||(t[5]=(...s)=>i.saveBatchRecords&&i.saveBatchRecords(...s)),disabled:!i.canSaveBatch},"批量保存",8,j),e("button",{type:"button",class:"btn-secondary",onClick:t[6]||(t[6]=(...s)=>i.cancelEdit&&i.cancelEdit(...s))},"取消")])]),e("div",O,[t[25]||(t[25]=e("h3",null,"杀二码组合列表",-1)),e("div",G,[b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>r.searchTerm=s),type:"text",placeholder:"搜索期号或杀二码组合...",class:"search-input"},null,512),[[y,r.searchTerm]]),e("button",{onClick:t[8]||(t[8]=(...s)=>i.deleteSelectedRecords&&i.deleteSelectedRecords(...s)),class:"btn-delete-batch",disabled:r.selectedRecords.length===0}," 批量删除 ",8,H)]),e("div",J,[e("table",Q,[e("thead",null,[e("tr",null,[e("th",X,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=s=>r.selectAll=s),onChange:t[10]||(t[10]=(...s)=>i.toggleSelectAll&&i.toggleSelectAll(...s))},null,544),[[v,r.selectAll]])]),t[19]||(t[19]=e("th",null,"期号",-1)),t[20]||(t[20]=e("th",null,"杀二码组合",-1)),t[21]||(t[21]=e("th",null,"优先级",-1)),t[22]||(t[22]=e("th",null,"创建时间",-1)),t[23]||(t[23]=e("th",null,"操作",-1))])]),e("tbody",null,[(h(!0),c(k,null,f(i.filteredRecords,s=>(h(),c("tr",{key:s.id},[e("td",Y,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=d=>r.selectedRecords=d),value:s.id},null,8,Z),[[v,r.selectedRecords]])]),e("td",null,p(s.period),1),e("td",null,p(s.killTwoCode),1),e("td",null,[e("span",{class:w(["priority-badge",`priority-${s.priority}`])},p(i.getPriorityText(s.priority)),3)]),e("td",null,p(i.formatDate(s.createdAt)),1),e("td",$,[e("button",{class:"btn-edit",onClick:d=>i.editRecord(s)},"编辑",8,tt),e("button",{class:"btn-delete",onClick:d=>i.deleteRecord(s.id)},"删除",8,et)])]))),128))]),i.filteredRecords.length===0?(h(),c("tfoot",ot,[...t[24]||(t[24]=[e("tr",null,[e("td",{colspan:"6",class:"no-data"},"暂无数据")],-1)])])):m("",!0)])]),i.totalPages>1?(h(),c("div",st,[e("button",{onClick:t[12]||(t[12]=s=>r.currentPage--),disabled:r.currentPage===1,class:"btn-pagination"}," 上一页 ",8,lt),e("span",rt," 第 "+p(r.currentPage)+" / "+p(i.totalPages)+" 页 ",1),e("button",{onClick:t[13]||(t[13]=s=>r.currentPage++),disabled:r.currentPage===i.totalPages,class:"btn-pagination"}," 下一页 ",8,it)])):m("",!0)])])])}const ut=I(x,[["render",at],["__scopeId","data-v-17780ad1"]]);export{ut as default};
