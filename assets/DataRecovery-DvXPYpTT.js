var I=(s,t,e)=>new Promise((r,o)=>{var i=n=>{try{h(e.next(n))}catch(m){o(m)}},g=n=>{try{h(e.throw(n))}catch(m){o(m)}},h=n=>n.done?r(n.value):Promise.resolve(n.value).then(i,g);h((e=e.apply(s,t)).next())});import{l as d}from"./utils-DurHG9wo.js";import{_ as N}from"./index-BXDNWbx7.js";import{c as l,a,b as C,t as u,o as c}from"./vendor-XXQc_yx5.js";class S{constructor(){this.worker=null,this.callbacks=new Map,this.initialized=!1,this.initWorker()}initWorker(){try{console.log("尝试初始化SharedWorker...");const t=new URL("data:text/javascript;base64,Ly8gU2hhcmVkV29ya2Vy5a6e546w5pWw5o2u5YWx5LqrDQpjb25zdCBjb25uZWN0aW9ucyA9IFtdOw0KY29uc3Qgc2hhcmVkRGF0YSA9IG5ldyBNYXAoKTsNCg0KLy8g5aSE55CG5raI5oGvDQpzZWxmLm9uY29ubmVjdCA9IGZ1bmN0aW9uKGUpIHsNCiAgY29uc3QgcG9ydCA9IGUucG9ydHNbMF07DQogIGNvbm5lY3Rpb25zLnB1c2gocG9ydCk7DQogIA0KICBwb3J0Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHsNCiAgICBjb25zdCB7IGFjdGlvbiwga2V5LCB2YWx1ZSB9ID0gZS5kYXRhOw0KICAgIA0KICAgIHN3aXRjaChhY3Rpb24pIHsNCiAgICAgIGNhc2UgJ2dldCc6DQogICAgICAgIC8vIOiOt+WPluaVsOaNrg0KICAgICAgICBwb3J0LnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAncmVzcG9uc2UnLA0KICAgICAgICAgIGtleSwNCiAgICAgICAgICB2YWx1ZTogc2hhcmVkRGF0YS5nZXQoa2V5KQ0KICAgICAgICB9KTsNCiAgICAgICAgYnJlYWs7DQogICAgICAgIA0KICAgICAgY2FzZSAnc2V0JzoNCiAgICAgICAgLy8g6K6+572u5pWw5o2u5bm25bm/5pKt57uZ5omA5pyJ6L+e5o6lDQogICAgICAgIHNoYXJlZERhdGEuc2V0KGtleSwgdmFsdWUpOw0KICAgICAgICBicm9hZGNhc3RNZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAndXBkYXRlJywNCiAgICAgICAgICBrZXksDQogICAgICAgICAgdmFsdWUNCiAgICAgICAgfSk7DQogICAgICAgIHBvcnQucG9zdE1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywNCiAgICAgICAgICBrZXkNCiAgICAgICAgfSk7DQogICAgICAgIGJyZWFrOw0KICAgICAgICANCiAgICAgIGNhc2UgJ3JlbW92ZSc6DQogICAgICAgIC8vIOWIoOmZpOaVsOaNruW5tuW5v+aSrQ0KICAgICAgICBzaGFyZWREYXRhLmRlbGV0ZShrZXkpOw0KICAgICAgICBicm9hZGNhc3RNZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAncmVtb3ZlJywNCiAgICAgICAgICBrZXkNCiAgICAgICAgfSk7DQogICAgICAgIHBvcnQucG9zdE1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywNCiAgICAgICAgICBrZXkNCiAgICAgICAgfSk7DQogICAgICAgIGJyZWFrOw0KICAgIH0NCiAgfTsNCiAgDQogIC8vIOi/nuaOpeWFs+mXreaXtuenu+mZpA0KICBwb3J0Lm9ubWVzc2FnZWVycm9yID0gcG9ydC5vbmNsb3NlID0gZnVuY3Rpb24oKSB7DQogICAgY29uc3QgaW5kZXggPSBjb25uZWN0aW9ucy5pbmRleE9mKHBvcnQpOw0KICAgIGlmIChpbmRleCAhPT0gLTEpIHsNCiAgICAgIGNvbm5lY3Rpb25zLnNwbGljZShpbmRleCwgMSk7DQogICAgfQ0KICB9Ow0KfTsNCg0KLy8g5bm/5pKt5raI5oGv57uZ5omA5pyJ6L+e5o6lDQpmdW5jdGlvbiBicm9hZGNhc3RNZXNzYWdlKG1lc3NhZ2UpIHsNCiAgZm9yIChjb25zdCBwb3J0IG9mIGNvbm5lY3Rpb25zKSB7DQogICAgdHJ5IHsNCiAgICAgIHBvcnQucG9zdE1lc3NhZ2UobWVzc2FnZSk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgY29uc29sZS5lcnJvcignQnJvYWRjYXN0IGZhaWxlZDonLCBlKTsNCiAgICB9DQogIH0NCn0=",import.meta.url);this.worker=new SharedWorker(t),console.log("SharedWorker初始化成功"),this.worker.port.onmessage=e=>{console.log("收到SharedWorker消息:",e.data);const{type:r,key:o,value:i}=e.data;r==="response"&&this.callbacks.has(o)&&(this.callbacks.get(o)(i),this.callbacks.delete(o)),r==="update"&&this.onUpdate&&this.onUpdate(o,i)},this.initialized=!0}catch(t){console.error("SharedWorker初始化失败:",t),this.degradeToLocalStorage()}}degradeToLocalStorage(){console.warn("降级到本地存储模式"),this.localMode=!0,this.initialized=!0}getItem(t){return new Promise(e=>{if(!this.initialized){setTimeout(()=>this.getItem(t).then(e),100);return}if(this.localMode){const r=localStorage.getItem(t);e(r?JSON.parse(r):null);return}this.callbacks.set(t,e),this.worker.port.postMessage({action:"get",key:t})})}setItem(t,e){return new Promise(r=>{if(!this.initialized){setTimeout(()=>this.setItem(t,e).then(r),100);return}if(this.localMode){localStorage.setItem(t,JSON.stringify(e)),r(!0);return}this.callbacks.set(t,r),this.worker.port.postMessage({action:"set",key:t,value:e})})}removeItem(t){return new Promise(e=>{if(!this.initialized){setTimeout(()=>this.removeItem(t).then(e),100);return}if(this.localMode){localStorage.removeItem(t),e(!0);return}this.callbacks.set(t,e),this.worker.port.postMessage({action:"remove",key:t})})}setUpdateListener(t){this.onUpdate=t}close(){this.worker&&(this.worker.port.close(),this.worker=null),this.initialized=!1,this.callbacks.clear()}}const A=new S,y={name:"DataRecovery",data(){return{originalData:null,currentStorageData:null,recoveryStatus:"",sharingTestResult:""}},methods:{detectOriginalData(){return I(this,null,function*(){try{this.recoveryStatus="正在检测原有数据...";const s=d.createInstance({name:"numberPrediction",storeName:"fourCodeMaintenance"}),t=yield s.keys();if(t.length===0){this.recoveryStatus="没有找到原有数据",this.originalData=null;return}const e={};for(const r of t)e[r]=yield s.getItem(r);this.originalData=e,this.recoveryStatus=`找到 ${t.length} 条记录`}catch(s){console.error("检测数据时出错:",s),this.recoveryStatus="检测数据时出错: "+s.message}})},recoverData(){return I(this,null,function*(){try{if(!this.originalData){this.recoveryStatus="请先检测数据";return}this.recoveryStatus="正在恢复数据...";const s=d.createInstance({name:"numberPrediction",storeName:"fourCodeMaintenance"}),t=[];for(const[e,r]of Object.entries(this.originalData))t.push(s.setItem(e,r)),t.push(A.setItem(`fourCode_${e}`,r));yield Promise.all(t),this.recoveryStatus="数据恢复成功！"}catch(s){console.error("恢复数据时出错:",s),this.recoveryStatus="恢复数据时出错: "+s.message}})},checkCurrentStorage(){return I(this,null,function*(){try{this.recoveryStatus="正在检查当前存储...";const s=d.createInstance({name:"numberPrediction",storeName:"fourCodeMaintenance"}),t=yield s.keys(),e={};for(const r of t)e[r]=yield s.getItem(r);this.currentStorageData=e,this.recoveryStatus=`当前存储中有 ${t.length} 条记录`,console.log("检查共享存储状态:",A)}catch(s){console.error("检查存储时出错:",s),this.recoveryStatus="检查存储时出错: "+s.message}})},testDataSharing(){return I(this,null,function*(){try{this.sharingTestResult="正在测试数据共享...";const s="test_sharing_key",t={timestamp:Date.now(),message:"测试数据"};console.log("测试共享存储 - 设置数据"),yield A.setItem(s,t),console.log("测试共享存储 - 获取数据");const e=yield A.getItem(s);e&&e.timestamp===t.timestamp?this.sharingTestResult="数据共享测试成功！":(this.sharingTestResult="数据共享测试失败：获取的数据与设置的不一致",console.log("原始值:",t),console.log("获取的值:",e)),yield A.removeItem(s)}catch(s){console.error("测试数据共享时出错:",s),this.sharingTestResult="测试数据共享时出错: "+s.message}})}}},p={class:"data-recovery"},b={class:"recovery-section"},k={key:0,class:"data-info"},v={key:0,class:"recovery-section"},w={key:0,class:"status-message"},D={class:"recovery-section"},Z={key:0,class:"data-info"},f={class:"recovery-section"},W={key:0,class:"status-message"};function G(s,t,e,r,o,i){return c(),l("div",p,[t[9]||(t[9]=a("h2",null,"数据恢复工具",-1)),t[10]||(t[10]=a("p",null,"此工具用于检测和恢复四码组合数据",-1)),a("div",b,[t[4]||(t[4]=a("h3",null,"检测原有数据",-1)),a("button",{onClick:t[0]||(t[0]=(...g)=>i.detectOriginalData&&i.detectOriginalData(...g)),class:"btn"},"检测数据"),o.originalData?(c(),l("div",k,[a("p",null,"找到原有数据，共 "+u(Object.keys(o.originalData).length)+" 条记录",1),a("pre",null,u(JSON.stringify(o.originalData,null,2)),1)])):C("",!0)]),o.originalData?(c(),l("div",v,[t[5]||(t[5]=a("h3",null,"恢复数据",-1)),a("button",{onClick:t[1]||(t[1]=(...g)=>i.recoverData&&i.recoverData(...g)),class:"btn btn-primary"},"恢复数据"),o.recoveryStatus?(c(),l("p",w,u(o.recoveryStatus),1)):C("",!0)])):C("",!0),a("div",D,[t[7]||(t[7]=a("h3",null,"检查当前存储",-1)),a("button",{onClick:t[2]||(t[2]=(...g)=>i.checkCurrentStorage&&i.checkCurrentStorage(...g)),class:"btn"},"检查当前存储"),o.currentStorageData?(c(),l("div",Z,[t[6]||(t[6]=a("p",null,"当前存储中的数据：",-1)),a("pre",null,u(JSON.stringify(o.currentStorageData,null,2)),1)])):C("",!0)]),a("div",f,[t[8]||(t[8]=a("h3",null,"测试数据共享",-1)),a("button",{onClick:t[3]||(t[3]=(...g)=>i.testDataSharing&&i.testDataSharing(...g)),class:"btn"},"测试共享存储"),o.sharingTestResult?(c(),l("p",W,u(o.sharingTestResult),1)):C("",!0)])])}const Q=N(y,[["render",G],["__scopeId","data-v-f9139873"]]);export{Q as default};
