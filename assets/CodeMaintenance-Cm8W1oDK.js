var M=Object.defineProperty,x=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var S=(t,e,r)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,D=(t,e)=>{for(var r in e||(e={}))N.call(e,r)&&S(t,r,e[r]);if(R)for(var r of R(e))P.call(e,r)&&S(t,r,e[r]);return t},w=(t,e)=>x(t,F(e));var u=(t,e,r)=>new Promise((a,n)=>{var i=l=>{try{h(r.next(l))}catch(m){n(m)}},s=l=>{try{h(r.throw(l))}catch(m){n(m)}},h=l=>l.done?a(l.value):Promise.resolve(l.value).then(i,s);h((r=r.apply(t,e)).next())});import{l as C}from"./utils-DurHG9wo.js";import{c as d,a as o,l as p,v as y,b as g,F as k,B,D as b,k as v,p as I,t as f,o as c,n as T}from"./vendor-XXQc_yx5.js";import{_ as A}from"./index-BiK889hT.js";const q={name:"CodeMaintenance",data(){return{records:[],formData:{period:"",code:"",codeType:"one",priority:"3"},batchFormData:{period:""},batchRows:[],batchInputText:"",editingId:null,searchTerm:"",typeFilter:"",currentPage:1,pageSize:10,selectedRecords:[],selectAll:!1,codeMaintenanceStorage:null}},computed:{filteredRecords(){let t=[...this.records];if(this.searchTerm){const r=this.searchTerm.toLowerCase();t=t.filter(a=>a.period.toLowerCase().includes(r)||a.code.toLowerCase().includes(r))}this.typeFilter&&(t=t.filter(r=>r.codeType===this.typeFilter)),t.sort((r,a)=>a.period.localeCompare(r.period));const e=(this.currentPage-1)*this.pageSize;return t.slice(e,e+this.pageSize)},totalPages(){let t=[...this.records];if(this.searchTerm){const e=this.searchTerm.toLowerCase();t=t.filter(r=>r.period.toLowerCase().includes(e)||r.code.toLowerCase().includes(e))}return this.typeFilter&&(t=t.filter(e=>e.codeType===this.typeFilter)),Math.ceil(t.length/this.pageSize)},hasTestData(){return this.records.some(t=>t.id&&t.id.startsWith("test"))},canSaveBatch(){return this.batchFormData.period&&this.batchRows.length>0&&this.batchRows.every(t=>!t.isError&&t.code&&t.priority&&this.validateBatchCodeByLength(t))}},watch:{filteredRecords(){this.selectedRecords=[],this.selectAll=!1},"formData.code":{handler(t){this.autoSelectCodeType(t)},immediate:!0}},mounted(){this.codeMaintenanceStorage=C.createInstance({name:"number-prediction-db",storeName:"code-maintenance"}),this.loadRecords(),this.loadMaxPeriod(),this.addTestDataIfNeeded();for(let t=0;t<3;t++)this.addBatchRow()},methods:{loadRecords(){return u(this,null,function*(){try{const t=yield this.codeMaintenanceStorage.getItem("codeRecords");this.records=t||[]}catch(t){console.error("加载胆码记录失败:",t),alert("加载失败，请刷新页面重试")}})},loadMaxPeriod(){return u(this,null,function*(){try{const t=C.createInstance({name:"number-prediction-db",storeName:"period-management"}),e=yield t.keys(),r=[];for(const a of e){const n=yield t.getItem(a);n&&n.periodNumber&&r.push(n.periodNumber)}if(r.length>0){r.sort((n,i)=>i.localeCompare(n));const a=r[0];this.batchFormData.period=a,console.log("自动加载最大期号:",a)}else console.log("期号管理列表为空，无法加载最大期号")}catch(t){console.error("加载最大期号失败:",t)}})},saveRecord(){return u(this,null,function*(){if(this.validateCode())try{if(this.editingId){const e=this.records.findIndex(r=>r.id===this.editingId);e!==-1&&(this.records[e]=w(D({},this.records[e]),{code:this.formData.code,codeType:this.formData.codeType,priority:this.formData.priority,updatedAt:new Date().toISOString()}))}else{const e={id:Date.now().toString(),period:this.formData.period,code:this.formData.code,codeType:this.formData.codeType,priority:this.formData.priority,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};this.records.push(e)}const t=JSON.parse(JSON.stringify(this.records));yield this.codeMaintenanceStorage.setItem("codeRecords",t),this.resetForm(),alert(this.editingId?"编辑成功":"添加成功")}catch(t){console.error("保存记录失败:",t),alert("保存失败，请重试")}})},editRecord(t){this.editingId=t.id,this.formData={period:t.period,code:t.code,codeType:t.codeType,priority:t.priority},window.scrollTo({top:0,behavior:"smooth"})},deleteRecord(t){return u(this,null,function*(){if(confirm("确定要删除这条记录吗？"))try{this.records=this.records.filter(r=>r.id!==t);const e=JSON.parse(JSON.stringify(this.records));yield this.codeMaintenanceStorage.setItem("codeRecords",e),this.selectedRecords=this.selectedRecords.filter(r=>r!==t),alert("删除成功")}catch(e){console.error("删除记录失败:",e),alert("删除失败，请重试")}})},deleteSelectedRecords(){return u(this,null,function*(){if(this.selectedRecords.length!==0&&confirm(`确定要删除选中的 ${this.selectedRecords.length} 条记录吗？`))try{this.records=this.records.filter(e=>!this.selectedRecords.includes(e.id));const t=JSON.parse(JSON.stringify(this.records));yield this.codeMaintenanceStorage.setItem("codeRecords",t),this.selectedRecords=[],this.selectAll=!1,alert("批量删除成功")}catch(t){console.error("批量删除记录失败:",t),alert("批量删除失败，请重试")}})},cancelEdit(){this.resetForm()},resetForm(){this.editingId=null,this.formData={period:"",code:"",codeType:"one",priority:"3"},this.currentPage=1},addTestDataIfNeeded(){return u(this,null,function*(){try{const t=yield this.codeMaintenanceStorage.getItem("codeRecords");console.log("检查胆码维护数据，当前数据:",t),!t||t.length===0?(console.log("胆码维护列表为空，请手动添加真实数据"),console.log("胆码数据将根据用户选择的期号和类型从真实的维护列表获取，不加载模拟数据")):console.log("胆码维护列表已有真实数据，数量:",t.length)}catch(t){console.error("检查胆码维护数据失败:",t)}})},clearAllTestData(){return u(this,null,function*(){if(confirm("确定要清除所有模拟数据吗？清除后需要手动添加真实数据。"))try{const t=this.records.filter(e=>!e.id||!e.id.startsWith("test"));if(t.length===0)yield this.codeMaintenanceStorage.removeItem("codeRecords");else{const e=JSON.parse(JSON.stringify(t));yield this.codeMaintenanceStorage.setItem("codeRecords",e)}yield this.loadRecords(),alert("模拟数据已清除，请手动添加真实数据")}catch(t){console.error("清除模拟数据失败:",t),alert("清除失败，请重试")}})},validateCode(){const{code:t,codeType:e}=this.formData,r={one:1,two:2,three:3,four:4,five:5}[e];if(t.length!==r)return alert(`请输入${r}个数字`),!1;for(const n of t)if(!/^[0-9]$/.test(n))return alert("每个字符必须是0-9之间的单个数字"),!1;return[...new Set(t)].length!==r?(alert(`请确保${r}个数字不重复`),!1):!0},getCodeTypeText(t){return{one:"一胆码",two:"两胆码",three:"三胆码",four:"四胆码",five:"五胆码"}[t]||"未知类型"},getPriorityText(t){return{1:"最高",2:"高",3:"中",4:"低",5:"最低"}[t]||"未知"},formatDate(t){return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},toggleSelectAll(){this.selectAll?this.selectedRecords=this.filteredRecords.map(t=>t.id):this.selectedRecords=[]},getCodePlaceholder(){return{one:"请输入1个数字",two:"请输入2个数字",three:"请输入3个数字",four:"请输入4个数字",five:"请输入5个数字"}[this.formData.codeType]||"请输入数字"},getCodeHint(){return{one:"请确保输入1个数字，范围0-9",two:"请确保输入2个不同的数字，范围0-9",three:"请确保输入3个不同的数字，范围0-9",four:"请确保输入4个不同的数字，范围0-9",five:"请确保输入5个不同的数字，范围0-9"}[this.formData.codeType]||"请确保输入不同的数字，范围0-9"},autoSelectCodeType(t){if(!t)return;const e=t.replace(/\D/g,""),r=e.length;switch(r){case 1:this.formData.codeType="two";break;case 2:this.formData.codeType="two";break;case 3:this.formData.codeType="three";break;case 4:this.formData.codeType="four";break;case 5:this.formData.codeType="five";break;default:r>5&&(this.formData.codeType="five");break}e!==t&&(this.formData.code=e)},addBatchRow(){this.batchRows.push({id:Date.now()+Math.random(),code:"",codeType:"one",priority:"3"})},removeBatchRow(t){this.batchRows.splice(t,1)},clearBatchRows(){this.batchRows=[]},saveBatchRecords(){return u(this,null,function*(){if(!this.canSaveBatch){alert("请填写完整的期号和所有胆码数据");return}const t=this.batchRows.filter(e=>!e.isError);if(t.length===0){alert("没有有效的胆码数据可以保存");return}try{const e=t.map(a=>{const n=a.codeType||this.getCodeTypeByLength(a.code);return{id:Date.now().toString()+Math.random().toString(36).substr(2,9),period:this.batchFormData.period,code:a.code,codeType:n,priority:a.priority,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}});this.records.push(...e);const r=JSON.parse(JSON.stringify(this.records));yield this.codeMaintenanceStorage.setItem("codeRecords",r),this.clearBatchRows(),this.batchFormData.period="",alert(`成功添加 ${e.length} 条胆码记录`)}catch(e){console.error("批量保存记录失败:",e),alert("批量保存失败，请重试")}})},validateBatchCode(t){const{code:e,codeType:r}=t,a={one:1,two:2,three:3,four:4,five:5}[r];if(e.length!==a)return!1;for(const i of e)if(!/^[0-9]$/.test(i))return!1;return[...new Set(e)].length===a},autoSelectBatchCodeType(t){if(!t.code)return;const e=t.code.replace(/\D/g,""),r=e.length;switch(r){case 1:t.codeType="two";break;case 2:t.codeType="two";break;case 3:t.codeType="three";break;case 4:t.codeType="four";break;case 5:t.codeType="five";break;default:r>5&&(t.codeType="five");break}e!==t.code&&(t.code=e)},getBatchCodePlaceholder(t){return{one:"请输入1个数字",two:"请输入2个数字",three:"请输入3个数字",four:"请输入4个数字",five:"请输入5个数字"}[t]||"请输入数字"},processBatchInput(){if(!this.batchInputText.trim())return;const t=this.batchInputText.split(/[,，]/).map(a=>a.trim()).filter(a=>a);if(t.length===0){alert("请输入有效的胆码数据");return}this.batchRows=[],t.forEach(a=>{this.validateBatchCodeFormat(a)?this.batchRows.push({id:Date.now()+Math.random(),code:a,codeType:this.getCodeTypeByLength(a),priority:"3",isError:!1}):this.batchRows.push({id:Date.now()+Math.random(),code:a,codeType:this.getCodeTypeByLength(a),priority:"3",isError:!0,errorMessage:this.getBatchCodeErrorMessage(a)})}),this.batchInputText="";const e=this.batchRows.filter(a=>!a.isError).length,r=this.batchRows.filter(a=>a.isError).length;r>0?alert(`批量导入完成！成功导入 ${e} 条，${r} 条格式错误（已标红）`):alert(`成功导入 ${e} 条胆码数据`)},validateBatchCodeFormat(t){if(!/^\d+$/.test(t))return!1;const e=t.length;return!(e<1||e>8||[...new Set(t)].length!==t.length)},validateBatchCodeByLength(t){const{code:e}=t;if(!/^\d+$/.test(e))return!1;const r=e.length;return!(r<1||r>8||[...new Set(e)].length!==e.length)},getCodeTypeByLength(t){switch(t.length){case 1:return"two";case 2:return"two";case 3:return"three";case 4:return"four";case 5:return"five";case 6:return"five";case 7:return"five";case 8:return"five";default:return"five"}},getBatchCodeErrorMessage(t){if(!/^\d+$/.test(t))return"必须为纯数字";const e=t.length;return e<1||e>8?"长度必须在1-8位之间":[...new Set(t)].length!==t.length?"数字不能重复":"格式错误"}}},E={class:"code-maintenance"},L={class:"batch-form-section"},O={class:"batch-controls"},V={class:"form-group"},U=["disabled"],_={class:"form-group"},J={class:"batch-actions"},z={class:"batch-table-container"},W={class:"batch-table"},H=["onUpdate:modelValue","placeholder","onInput"],j={key:0,class:"error-message"},G=["onUpdate:modelValue"],K=["onUpdate:modelValue"],Q=["onClick"],X={key:0},Y={class:"batch-actions"},Z=["disabled"],$={class:"table-section"},ee={class:"search-group"},te=["disabled"],oe={class:"records-table-container"},re={class:"data-table"},se={class:"checkbox-col"},ae={class:"checkbox-col"},ie=["value"],ne={class:"action-buttons"},le=["onClick"],de=["onClick"],ce={key:0},he={key:0,class:"pagination"},ue=["disabled"],pe={class:"page-info"},fe=["disabled"];function ge(t,e,r,a,n,i){return c(),d("div",E,[e[31]||(e[31]=o("h2",null,"胆码组合维护",-1)),e[32]||(e[32]=o("p",null,"管理不同期号的各种类型胆码组合，设置优先级，用于数字预测",-1)),o("div",L,[o("div",O,[o("div",V,[e[16]||(e[16]=o("label",{for:"period"},"期号 *",-1)),p(o("input",{id:"period","onUpdate:modelValue":e[0]||(e[0]=s=>n.batchFormData.period=s),type:"text",placeholder:"请输入期号，如：2024001",disabled:n.editingId,required:""},null,8,U),[[y,n.batchFormData.period]])]),o("div",_,[e[17]||(e[17]=o("label",{for:"batchInput"},"批量输入胆码",-1)),p(o("input",{id:"batchInput","onUpdate:modelValue":e[1]||(e[1]=s=>n.batchInputText=s),type:"text",placeholder:"请输入多组胆码，用逗号分隔，如：146,679,1359,4568",onBlur:e[2]||(e[2]=(...s)=>i.processBatchInput&&i.processBatchInput(...s))},null,544),[[y,n.batchInputText]])]),o("div",J,[o("button",{type:"button",class:"btn-primary",onClick:e[3]||(e[3]=(...s)=>i.addBatchRow&&i.addBatchRow(...s))},"添加行"),o("button",{type:"button",class:"btn-secondary",onClick:e[4]||(e[4]=(...s)=>i.clearBatchRows&&i.clearBatchRows(...s))},"清空")])]),o("div",z,[o("table",W,[e[21]||(e[21]=o("thead",null,[o("tr",null,[o("th",null,"序号"),o("th",null,"胆码 *"),o("th",null,"胆码类型 *"),o("th",null,"优先级 *"),o("th",null,"操作")])],-1)),o("tbody",null,[(c(!0),d(k,null,B(n.batchRows,(s,h)=>(c(),d("tr",{key:s.id,class:T({"error-row":s.isError})},[o("td",null,f(h+1),1),o("td",null,[p(o("input",{"onUpdate:modelValue":l=>s.code=l,type:"text",placeholder:i.getBatchCodePlaceholder(s.codeType),onInput:l=>i.autoSelectBatchCodeType(s),class:T({"error-input":s.isError}),required:""},null,42,H),[[y,s.code]]),s.isError?(c(),d("div",j,f(s.errorMessage),1)):g("",!0)]),o("td",null,[p(o("select",{"onUpdate:modelValue":l=>s.codeType=l,required:""},[...e[18]||(e[18]=[v('<option value="one" data-v-507a6f21>一胆码</option><option value="two" data-v-507a6f21>两胆码</option><option value="three" data-v-507a6f21>三胆码</option><option value="four" data-v-507a6f21>四胆码</option><option value="five" data-v-507a6f21>五胆码</option>',5)])],8,G),[[b,s.codeType]])]),o("td",null,[p(o("select",{"onUpdate:modelValue":l=>s.priority=l,required:""},[...e[19]||(e[19]=[v('<option value="1" data-v-507a6f21>1 - 最高</option><option value="2" data-v-507a6f21>2 - 高</option><option value="3" data-v-507a6f21>3 - 中</option><option value="4" data-v-507a6f21>4 - 低</option><option value="5" data-v-507a6f21>5 - 最低</option>',5)])],8,K),[[b,s.priority]])]),o("td",null,[n.batchRows.length>1?(c(),d("button",{key:0,type:"button",class:"btn-delete",onClick:l=>i.removeBatchRow(h)},"删除",8,Q)):g("",!0)])],2))),128))]),n.batchRows.length===0?(c(),d("tfoot",X,[...e[20]||(e[20]=[o("tr",null,[o("td",{colspan:"5",class:"no-data"},'请点击"添加行"开始录入胆码数据')],-1)])])):g("",!0)])]),o("div",Y,[o("button",{type:"button",class:"btn-primary",onClick:e[5]||(e[5]=(...s)=>i.saveBatchRecords&&i.saveBatchRecords(...s)),disabled:!i.canSaveBatch},"批量保存",8,Z),o("button",{type:"button",class:"btn-secondary",onClick:e[6]||(e[6]=(...s)=>i.cancelEdit&&i.cancelEdit(...s))},"取消")])]),o("div",$,[e[30]||(e[30]=o("h3",null,"胆码组合列表",-1)),o("div",ee,[p(o("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>n.searchTerm=s),type:"text",placeholder:"搜索期号或胆码...",class:"search-input"},null,512),[[y,n.searchTerm]]),p(o("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.typeFilter=s),class:"filter-input"},[...e[22]||(e[22]=[v('<option value="" data-v-507a6f21>所有类型</option><option value="one" data-v-507a6f21>一胆码</option><option value="two" data-v-507a6f21>两胆码</option><option value="three" data-v-507a6f21>三胆码</option><option value="four" data-v-507a6f21>四胆码</option><option value="five" data-v-507a6f21>五胆码</option>',6)])],512),[[b,n.typeFilter]]),o("button",{onClick:e[9]||(e[9]=(...s)=>i.deleteSelectedRecords&&i.deleteSelectedRecords(...s)),class:"btn-delete-batch",disabled:n.selectedRecords.length===0}," 批量删除 ",8,te),i.hasTestData?(c(),d("button",{key:0,onClick:e[10]||(e[10]=(...s)=>i.clearAllTestData&&i.clearAllTestData(...s)),class:"btn-clear-test"}," 清除模拟数据 ")):g("",!0)]),o("div",oe,[o("table",re,[o("thead",null,[o("tr",null,[o("th",se,[p(o("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=s=>n.selectAll=s),onChange:e[12]||(e[12]=(...s)=>i.toggleSelectAll&&i.toggleSelectAll(...s))},null,544),[[I,n.selectAll]])]),e[23]||(e[23]=o("th",null,"期号",-1)),e[24]||(e[24]=o("th",null,"胆码",-1)),e[25]||(e[25]=o("th",null,"胆码类型",-1)),e[26]||(e[26]=o("th",null,"优先级",-1)),e[27]||(e[27]=o("th",null,"创建时间",-1)),e[28]||(e[28]=o("th",null,"操作",-1))])]),o("tbody",null,[(c(!0),d(k,null,B(i.filteredRecords,s=>(c(),d("tr",{key:s.id},[o("td",ae,[p(o("input",{type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=h=>n.selectedRecords=h),value:s.id},null,8,ie),[[I,n.selectedRecords]])]),o("td",null,f(s.period),1),o("td",null,f(s.code),1),o("td",null,f(i.getCodeTypeText(s.codeType)),1),o("td",null,[o("span",{class:T(["priority-badge",`priority-${s.priority}`])},f(i.getPriorityText(s.priority)),3)]),o("td",null,f(i.formatDate(s.createdAt)),1),o("td",ne,[o("button",{class:"btn-edit",onClick:h=>i.editRecord(s)},"编辑",8,le),o("button",{class:"btn-delete",onClick:h=>i.deleteRecord(s.id)},"删除",8,de)])]))),128))]),i.filteredRecords.length===0?(c(),d("tfoot",ce,[...e[29]||(e[29]=[o("tr",null,[o("td",{colspan:"7",class:"no-data"},"暂无数据")],-1)])])):g("",!0)])]),i.totalPages>1?(c(),d("div",he,[o("button",{onClick:e[14]||(e[14]=s=>n.currentPage--),disabled:n.currentPage===1,class:"btn-pagination"}," 上一页 ",8,ue),o("span",pe," 第 "+f(n.currentPage)+" / "+f(i.totalPages)+" 页 ",1),o("button",{onClick:e[15]||(e[15]=s=>n.currentPage++),disabled:n.currentPage===i.totalPages,class:"btn-pagination"}," 下一页 ",8,fe)])):g("",!0)])])}const Te=A(q,[["render",ge],["__scopeId","data-v-507a6f21"]]);export{Te as default};
